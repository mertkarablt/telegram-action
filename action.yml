name: 'Telegram Message Notify'
description: 'Sending a Telegram message'
author: 'Bo-Yi Wu'

inputs:
  to:
    description: 'telegram user'
    required: true
  token:
    description: 'telegram token'
    required: true
  message:
    description: 'telegram message'
  message_file:
    description: 'overwrite the default message template with the contents of the specified file'
  socks5:
    description: 'support socks5 proxy URL'
  photo:
    description: 'send the photo message.'
  document:
    description: 'send the document message.'
  sticker:
    description: 'send the sticker message.'
  audio:
    description: 'send the audio message.'
  voice:
    description: 'send the voice message.'
  location:
    description: 'send the location message.'
  venue:
    description: 'send the venue message.'
  video:
    description: 'send the video message.'
  debug:
    description: 'enable debug mode.'
  format:
    description: 'message format: markdown or html'
  disable_web_page_preview:
    description: 'disables link previews for links in this message'
  disable_notification:
    description: 'disables notifications for this message, supports sending a message without notification,'

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Create bin directory
      shell: bash
      run: |
        if [ ! -d "$HOME/bin" ]; then
          mkdir -p $HOME/bin
          echo "$HOME/bin" >> $GITHUB_PATH
        fi

    - name: Download drone-telegram binary
      shell: bash
      run: |
        if [ ! -f "$HOME/bin/drone-telegram" ]; then
          curl -L -o $HOME/bin/drone-telegram https://github.com/appleboy/drone-telegram/releases/download/v1.3.10/drone-telegram-v1.3.10-darwin-amd64
        fi
        chmod +x $HOME/bin/drone-telegram

    - name: Run Telegram Notify Script
      shell: bash
      run: |
        chmod +x $GITHUB_ACTION_PATH/entrypoint.sh
        $GITHUB_ACTION_PATH/entrypoint.sh

branding:
  icon: 'message-square'
  color: 'blue'